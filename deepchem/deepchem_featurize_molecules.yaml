name: deepchem_featurize_molecules

description: >
  Convert molecular structures (SMILES, InChI, or RDKit molecules) into numerical feature representations
  suitable for machine learning. Supports 50+ featurization methods including circular fingerprints (ECFP),
  RDKit descriptors, graph convolution features, and Coulomb matrices.
  Best-in-class featurizer library with extensive validation on MoleculeNet benchmarks.
  Choose featurizer based on downstream model: fingerprints for traditional ML, graphs for GNNs.

required_parameters:
  - name: molecules
    type: list[str]
    default: null
    description: >
      List of molecular structures to featurize. Can be SMILES strings (most common),
      InChI strings, or molecule objects. Examples: ['CCO', 'c1ccccc1', 'CC(=O)O'].
      Invalid molecules will raise RDKit errors unless error handling is enabled.

  - name: featurizer_type
    type: str
    default: null
    description: >
      Type of featurization to apply. Options: 'CircularFingerprint', 'RDKitDescriptors',
      'MolGraphConvFeaturizer', 'MACCSKeysFingerprint', 'CoulombMatrix', 'Mol2VecFingerprint',
      'WeaveFeaturizer'. Choice depends on downstream model and data size.

optional_parameters:
  - name: size
    type: int
    default: 2048
    description: >
      Fingerprint size (for CircularFingerprint, MorganFingerprint).
      Common values: 1024, 2048, 4096.
      Larger sizes capture more information but increase memory and computation.
      Only applicable for fingerprint-based featurizers.

  - name: radius
    type: int
    default: 2
    description: >
      Circular fingerprint radius (for ECFP).
      Typical values: 2 (ECFP4), 3 (ECFP6).
      Larger radius captures more distant structural information.
      Only applicable for circular fingerprints.

  - name: use_edges
    type: bool
    default: true
    description: >
      For graph featurizers: include edge (bond) features in addition to node (atom) features.
      Improves performance for models that can use edge information (MPNN, GAT).
      Increases feature size by ~3x. Only for graph-based featurizers.

  - name: max_atoms
    type: int
    default: 50
    description: >
      Maximum number of atoms for Coulomb matrix featurization.
      Molecules larger than this will be truncated or padded.
      Higher values increase memory: scales as O(max_atoms²).
      Only for CoulombMatrix featurizer.

  - name: n_jobs
    type: int
    default: 1
    description: >
      Number of parallel jobs for featurization.
      -1 uses all CPU cores.
      Speedup: ~linear up to number of physical cores.
      Large datasets (>10K molecules) benefit significantly from parallelization.

hardware_requirements:
  device: cpu_only
  notes: >
    No GPU required; featurization is CPU-bound.
    Memory usage depends on: number of molecules × feature dimension × data type.
    Example: 10K molecules × 2048 features × 4 bytes = ~80MB.
    Graph featurizers use more memory: ~2-5x due to adjacency matrices.
    Recommend 4GB+ RAM for datasets >100K molecules.

time_complexity:
  assumptions: >
    Wall-clock latency on Apple M1 (8 cores) or equivalent.
    Molecules: average druglike size (20-40 heavy atoms, MW 300-500).
    Includes RDKit molecule parsing + featurization.
    Times scale linearly with molecule count and complexity.
    Graph featurizers ~2-3x slower than fingerprints.
  latency_seconds:
    n1: 0.01
    n100: 0.8
    n1000: 7.5
    n10000: 75
    n1_graph: 0.03
    n100_graph: 2.5
    n1000_parallel: 2.0

outputs:
  type: numpy.ndarray
  schema:
    shape: "(n_molecules, n_features)"
    dtype: varies by featurizer
    fingerprints: uint8 or float32
    descriptors: float64
    graphs: "object (dc.feat.mol_graphs.ConvMol)"
  example:
    featurizer: "CircularFingerprint(size=1024)"
    input: ["CCO", "c1ccccc1"]
    output_shape: "(2, 1024)"
    output_dtype: uint8
    output_sample: "[[0, 1, 0, 1, ...], [1, 0, 1, 0, ...]]"

failure_modes:
  - error: RDKit molecule parsing failed
    cause: Invalid SMILES string or corrupt molecular structure
    fix: Validate SMILES before featurization using RDKit.Chem.MolFromSmiles(), filter invalid molecules

  - error: MemoryError
    cause: Dataset too large for available RAM (common with >100K molecules and graph featurizers)
    fix: Process in batches, use fingerprints instead of graphs, or increase system memory

  - error: Featurizer not found
    cause: Incorrect featurizer_type string or missing DeepChem module
    fix: Check spelling, verify DeepChem installation, use dc.feat.list_featurizers() to see available options

  - error: "ValueError: molecule too large"
    cause: Molecule exceeds max_atoms for CoulombMatrix featurizer
    fix: Increase max_atoms parameter or filter large molecules before featurization

  - error: Parallelization overhead
    cause: Using n_jobs>1 on small datasets (<100 molecules) where overhead exceeds benefit
    fix: Use n_jobs=1 for small datasets; parallelization benefits appear at >1000 molecules
